[build]
  publish = "dist"
  command = "rm -rf node_modules package-lock.json && npm install --ignore-scripts && npx nuxt prepare && npm run generate"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--no-audit --no-fund"
  NPM_CONFIG_CACHE = "/tmp/.npm"
  NUXT_TELEMETRY_DISABLED = "1"
  CI = "true"

[context.production]
  command = "rm -rf node_modules package-lock.json && npm install --ignore-scripts && npx nuxt prepare && npm run generate"

[context.deploy-preview]
  command = "rm -rf node_modules package-lock.json && npm install --ignore-scripts && npx nuxt prepare && npm run generate"

# Keycloak reverse proxy redirects (matching Vercel pattern)
[[redirects]]
  from = "/auth/*"
  to = "https://casino-citizen.eks-dev01.gigndvr.com/auth/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/realms/*"
  to = "https://casino-citizen.eks-dev01.gigndvr.com/realms/:splat"
  status = 200
  force = true

# Assets redirect
[[redirects]]
  from = "/assets/*"
  to = "https://casino-citizen.eks-dev01.gigndvr.com/assets/:splat"
  status = 200
  force = true

# SPA fallback - must be last
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
